<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="utf-8"/>
    <link rel="apple-touch-icon" sizes="76x76" th:href="@{/assets/img/apple-icono.png}">
    <link rel="icon" type="image/png" th:href="@{/assets/img/favicono.png}">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <title>
        DiceVice
    </title>
    <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, shrink-to-fit=no'
          name='viewport'/>
    <!-- Extra details for Live View on GitHub Pages -->
    <!-- Canonical SEO -->
    <link rel="canonical" href="https://www.creative-tim.com/product/material-dashboard-pro}"/>
    <!--  Social tags      -->
    <!--     Fonts and icons     -->
    <link rel="stylesheet" type="text/css"
          href="https://fonts.googleapis.com/css?family=Recoto:300,400,500,700|Roboto+Slab:400,700|Material+Icons"/>
    <link rel="stylesheet"
          href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0"/>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css">
    <!-- CSS Files -->
    <link th:href="@{/assets/css/material-dashboard.min.css}" rel="stylesheet"/>
    <!-- CSS Just for demo purpose, don't include it in your project -->
    <link th:href="@{/assets/demo/demo.css}" rel="stylesheet}"/>
    <link th:href="@{/assets/css/customo.css}" rel="stylesheet}"/>
    <!-- Google Tag Manager -->
    <script th:src="@{/assets/js/core/jquery-3.2.1.min.js}"></script>
    <!--  DataTables.net Plugin, full documentation here: https://datatables.net/ -->
    <script th:src="@{/assets/js/plugins/jquery.dataTables.min.js}"></script>
    <style>
        .gon {
            padding-left: 121px;;
        }

        body {
            background: linear-gradient(90deg, rgba(17, 36, 0, 1) 0%, rgba(9, 121, 20, 1) 43%, rgba(17, 36, 0, 1) 100%);
        }

        .main-panel > .content {
            margin-top: 5px;
        }

        .sidebar .sidebar-background {
            border-radius: 0.85rem;
        }

        .sidebar[data-background-color="black"] .sidebar-background::after {
            border-radius: 0.75rem;
        }

        .sidebar {
            margin-top: 30px;
            margin-left: 20px;
            margin-bottom: 40px;
            border-radius: 0.75rem;
        }

        .main-panel > .content {
            padding: 30px 30px;
        }


        .col-lg-3 {
            flex: 0 0 25%;
            max-width: 25%;
            box-sizing: border-box;
            padding: 0px 18px;
        }

        .container-fluid {
            width: 90%;
            padding-right: 20px;
            padding-left: 0px;
        }

        .sidebar[data-background-color="black"] {
            background: #165723;
        }




        .sidebar-input {
            background: #0ff0;
            color: azure;
            border: 0;
        }
        .sidebar .user .user-info .caret {
            top: 16px !important;
        }

        .die-list {
            scale: 0.38;
        }



    </style>

</head>

<body class="">
<!-- Extra details for Live View on GitHub Pages -->
<!-- Google Tag Manager (noscript) -->
<!-- End Google Tag Manager (noscript) -->
<div class="wrapper ">
    <div class="sidebar" data-color="rose" data-background-color="black" data-image="/assets/img/sidebar-1.jpg">
        <!--
          Tip 1: You can change the color of the sidebar using: data-color="purple | azure | green | orange | danger"

          Tip 2: you can also add an image using data-image tag
      -->
        <div class="logo">
            <a href="http://www.creative-tim.com" class="simple-text logo-mini">
                CT
            </a>
            <a href="http://www.creative-tim.com" class="simple-text logo-normal">
                Creative Tim
            </a>
        </div>
        <div class="sidebar-wrapper">
            <div class="user">
                <div class="photo">
                    <img th:src="@{/assets/img/faces/avatar.jpg}"/>
                </div>
                <div class="user-info">
                    <a data-toggle="collapse" href="#collapseExample" class="username">
                        <input id="namePlayer" class="sidebar-input" style="width: 145px;" type="text" readonly
                               disabled="" th:value="${playerData.namePlayer}">
                        <input id="idPlayer" type="hidden" th:value="*{playerData.idPlayer}">
                        <b class="caret"></b>
                    </a>
                    <div class="collapse" id="collapseExample">
                        <ul class="nav">
                            <li class="nav-item">
                                <a class="nav-link"
                                   th:href="@{/jocdedaus/dashboard/{id}(id=${playerData.idPlayer},token=${playerData.token})}">
                                    <span class="sidebar-mini"><i class="material-icons right">casino</i></span>
                                    <span class="sidebar-normal"> Casino </span>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" id="btn-logout" >
                                    <span class="sidebar-mini material-symbols-outlined">logout</span>
                                    <span class="sidebar-normal"> Log Out </span>
                                </a>
                            </li>

                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="main-panel">

        <!-- End Navbar -->
        <div class="content">
            <div class="container-fluid">
                <div class="row">
                    <div style="display: flex; width: 100%">
                        <div class="col-lg-3 col-md-6 col-sm-6">
                            <div class="card card-stats">
                                <div class="card-header card-header-warning card-header-icon">
                                    <div class="card-icon">
                                        <i class="material-icons">casino</i>
                                    </div>
                                    <p class="card-category" style="width: 146px;">Total Throws</p>
                                    <h3 id="totalThrows" class="card-title"></h3>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-3 col-md-6 col-sm-6">
                            <div class="card card-stats">
                                <div class="card-header card-header-info card-header-icon">
                                    <div class="card-icon">
                                        <i class="material-icons">military_tech</i>
                                    </div>
                                    <p class="card-category">First</p>
                                    <h3 id="winner" class="card-title"></h3>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-3 col-md-6 col-sm-6">
                            <div class="card card-stats">
                                <div class="card-header card-header-success card-header-icon">
                                    <div class="card-icon">
                                        <i class="material-icons">123</i>
                                    </div>
                                    <p class="card-category" style="width: 140px;">Last</p>
                                    <h3 id="loser" class="card-title"></h3>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-3 col-md-6 col-sm-6">
                            <div class="card card-stats">
                                <div class="card-header card-header-rose card-header-icon">
                                    <div class="card-icon">
                                        <i class="material-icons">leaderboard</i>
                                    </div>
                                    <p class="card-category" style="width:154px;text-align: center;">Average</p>
                                    <h3 id="average" class="card-title"
                                    ></h3>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-12">
                        <div class="card">
                            <div class="card-header card-header-primary card-header-icon">
                                <div class="card-icon">
                                    <i class="material-icons">assignment</i>
                                </div>
                                <h4 class="card-title">Ranking List</h4>
                            </div>
                            <div class="card-body">
                                <div class="toolbar">
                                    <!--        Here you can write extra buttons/actions for the toolbar              -->
                                </div>
                                <div class="material-datatables">
                                    <table id="datatables" class="table table-no-bordered table-hover" cellspacing="0"
                                           width="100%" style="width:100%">
                                        <thead>
                                        <tr>
                                            <th>Player</th>
                                            <th class="text-center gon">Ranking</th>
                                            <th class="text-center gon">Throws</th>
                                            <th class="text-center gon">Points</th>
                                            <th class="text-center gon">Games</th>
                                            <th class="text-center">Average</th>
                                            <th class="text-center" style="width: 100px;">Status</th>
                                            <th style="width: 100px !important;">Start date</th>
                                        </tr>
                                        </thead>
                                        <tfoot>
                                        <tr>
                                            <th style="font-size: 0.9rem;">Player</th>
                                            <th class="text-center" style="font-size: 0.9rem;">Ranking</th>
                                            <th class="text-center" style="font-size: 0.9rem;">Throws</th>
                                            <th class="text-center" style="font-size: 0.9rem">Points</th>
                                            <th class="text-center" style="font-size: 0.9rem">Games</th>
                                            <th class="text-center" style="font-size: 0.9rem;">Average</th>
                                            <th class="text-center" style="font-size: 0.9rem;">Status</th>
                                            <th>Start date</th>
                                        </tr>
                                        </tfoot>

                                        <tbody id="tablePlayers">
                                        <script>

                                            const token = '[[${playerData.token}]]';
                                            $.ajaxSetup({

                                                headers: {
                                                    'Authorization': "Bearer " + token
                                                }
                                            });

                                            $.get("/jocdedaus/players/getAll/", function (data) {

                                                let totalThrows = 0;
                                                for (let i = 0; i < data.playerDTOList.length; i++) {
                                                    let result;
                                                    totalThrows += data.playerDTOList[i].scoreList.length;

                                                    if (data.playerDTOList[i].logged) {
                                                        result = "badge badge-sm bg-gradient-success";
                                                        //logged = $("<span class=\"badge badge-sm bg-gradient-success\">Online</span>\n");
                                                    } else {
                                                        result = "badge badge-sm bg-gradient-light";
                                                    }

                                                    const ratio = !isNaN(Math.round((data.playerDTOList[i].games / data.playerDTOList[i].scoreList.length) * 100)) ?
                                                        Math.round((data.playerDTOList[i].games / data.playerDTOList[i].scoreList.length) * 100) + "%"
                                                        : "--";

                                                    var tempDate = new Date(data.playerDTOList[i].signUpDate);
                                                    var formattedDate = [tempDate.getDate(), tempDate.getMonth() + 1, tempDate.getFullYear()].join('/');

                                                    $("#tablePlayers").append("<tr>\n" +
                                                        "                        <td class=\"mb-0 text-sm\">" + data.playerDTOList[i].namePlayer + "</td>\n" +
                                                        "                        <td class=\"mb-0 text-center\">" + data.playerDTOList[i].ranking + "</td>\n" +
                                                        "                        <td class=\"mb-0 text-center\">" + data.playerDTOList[i].scoreList.length + "</td>\n" +
                                                        "                        <td class=\"mb-0 text-center\">" + data.playerDTOList[i].points + "</td>\n" +
                                                        "                        <td class=\"mb-0 text-center\">" + data.playerDTOList[i].games + "</td>\n" +
                                                        "                        <td class=\"mb-0 text-center\">" + ratio + "</td>\n" +
                                                        "                        <td class=\"mb-0 text-center\" class=\"align-middle text-center text-sm\">\n" +
                                                        "                        <span class=\"" + result + "\">" + (data.playerDTOList[i].logged ? "Online" : "Offline") + "</span>\n" +
                                                        "                        </td>\n" +
                                                        "                        <td class=\"mb-0 text-sm text-center\">" + formattedDate + "</td>\n" +
                                                        "                      </tr>");


                                                } // end for

                                                $('#totalThrows').text(totalThrows);
                                            });

                                        </script>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <!-- end content-->
                        </div>
                        <!--  end card  -->
                    </div>
                    <!-- end col-md-12 -->
                </div>
                <!-- end row -->
            </div>
        </div>

    </div>
</div>

<!--   Core JS Files   -->

<script th:src="@{/assets/js/core/popper.min.js}"></script>
<script th:src="@{/assets/js/core/bootstrap-material-design.min.js}"></script>
<script th:src="@{/assets/js/plugins/perfect-scrollbar.min.js}"></script>
<!-- Plugin for the momentJs  -->
<script th:src="@{/assets/js/plugins/moment.min.js}"></script>
<!--  Plugin for Sweet Alert -->
<script th:src="@{/assets/js/plugins/sweetalert2.js}"></script>
<!-- Forms Validations Plugin -->
<script th:src="@{/assets/js/plugins/jquery.validate.min.js}"></script>
<!-- Plugin for the Wizard, full documentation here: https://github.com/VinceG/twitter-bootstrap-wizard -->
<script th:src="@{/assets/js/plugins/jquery.bootstrap-wizard.js}"></script>
<!--	Plugin for Select, full documentation here: https://silviomoreto.github.io/bootstrap-select -->
<script th:src="@{/assets/js/plugins/bootstrap-selectpicker.js}"></script>
<!--  Plugin for the DateTimePicker, full documentation here: https://eonasdan.github.io/bootstrap-datetimepicker/ -->
<script th:src="@{/assets/js/plugins/bootstrap-datetimepicker.min.js}"></script>
<!--  DataTables.net Plugin, full documentation here: https://datatables.net/ -->
<script th:src="@{/assets/js/plugins/jquery.dataTables.min.js}"></script>
<!--	Plugin for Tags, full documentation here: https://github.com/bootstrap-tagsinput/bootstrap-tagsinputs  -->
<script th:src="@{/assets/js/plugins/bootstrap-tagsinput.js}"></script>
<!-- Plugin for Fileupload, full documentation here: http://www.jasny.net/bootstrap/javascript/#fileinput -->
<script th:src="@{/assets/js/plugins/jasny-bootstrap.min.js}"></script>
<!--  Full Calendar Plugin, full documentation here: https://github.com/fullcalendar/fullcalendar    -->
<script th:src="@{/assets/js/plugins/fullcalendar.min.js}"></script>
<!-- Vector Map plugin, full documentation here: http://jvectormap.com/documentation/ -->
<script th:src="@{/assets/js/plugins/jquery-jvectormap.js}"></script>
<!--  Plugin for the Sliders, full documentation here: http://refreshless.com/nouislider/ -->
<script th:src="@{/assets/js/plugins/nouislider.min.js}"></script>
<!-- Include a polyfill for ES6 Promises (optional) for IE11, UC Browser and Android browser support SweetAlert -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/core-js/2.4.1/core.js"></script>
<!-- Library for adding dynamically elements -->
<script th:src="@{/assets/js/plugins/arrive.min.js}"></script>
<!--  Google Maps Plugin    -->
<!--<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB2Yno10-YTnLjjn_Vtk0V8cdcY5lC4plU"></script>-->
<!-- Place this tag in your head or just before your close body tag. -->
<!--<script async defer src="https://buttons.github.io/buttons.js}"></script>-->
<!-- Chartist JS -->
<script th:src="@{/assets/js/plugins/chartist.min.js}"></script>
<!--  Notifications Plugin    -->
<script th:src="@{/assets/js/plugins/bootstrap-notify.js}"></script>
<!-- Control Center for Material Dashboard: parallax effects, scripts for the example pages etc -->

<!-- Material Dashboard DEMO methods, don't include it in your project! -->
<script th:src="@{/assets/demo/demo.js}"></script>
<script>

    $(document).ready(function () {
        // alert(token);

        $.ajaxSetup({
            data: {idPlayer:  '[[${playerData.idPlayer}]]'},
            headers: {
                'Authorization': "Bearer " + token
            }
        });


        $.get("/jocdedaus/players/ranking/winner", function (data) {

            $('#winner').text(data.namePlayer);
        });


        $.get("/jocdedaus/players/ranking/loser", function (data) {

            $('#loser').text(data.namePlayer);
        });


        $.get("/jocdedaus/players/ranking", function (data) {

            let average = (data.rankingResult.toFixed(2));
            $('#average').text(average);
        });


    });
    // LOGOUT ACTION
    $("#btn-logout").click(function () {
        alert("Hola, manola");
        // $.ajaxSetup({
        //     data: {idPlayer:  '[[${playerData.idPlayer}]]'},
        //     headers: {
        //         'Authorization': "Bearer " + token
        //     }
        // });
        $.ajax({
            type: 'GET',
            url: '/jocdedaus/logout' ,
            data: {
                idPlayer:  '[[${playerData.idPlayer}]]',
                namePlayer:  '[[${playerData.namePlayer}]]',
            },
            // headers: {
            //     'Authorization': "Bearer " + token
            // },
            cache: false,
            success: function (result) {
               window.location.href = "../login";
             //  top.location.href="login.html";//redirection

            },
            error: function (jqXHR) {
                $(document.body).text('Error: ' + jqXHR.status);
            }});

    });

</script>

<!--<script>

    $(document).ready(function () {
        const token = '[[${playerData.token}]]';


alert(token);

        $('#datatables').DataTable({
            "pagingType": "full_numbers",
            "lengthMenu": [
                [5, 10, 25, 50, -1],
                [5, 10, 25, 50, "All"]
            ],
            responsive: true,
            language: {
                search: "_INPUT_",
                searchPlaceholder: "Search records",
            }
        });





        // $.ajaxSetup({
        //     headers: {
        //         'Authorization': "Bearer " + token
        //     }
        // });
        //
        // $.get("/jocdedaus/players/ranking/points", function (data) {
        //
        //  $('#points').text(data.wins);
        // });
        //
        // $.get("/jocdedaus/players/ranking/loser", function (data) {
        //
        //     $('#loser').text(data.namePlayer);
        // });
        //
        // $.get("/jocdedaus/players/ranking", function (data) {
        //
        //     let average = (data.rankingResult.toFixed(2));
        //     $('#average').text(average);
        // });
    });

</script>-->


</body>

</html>